<html>
<head>
	<style>
	.board-overlay {
		border-radius: 10pt;
		background: #aaa;
		padding: 10pt;
		border: 1px solid black;
		display:inline-block;
	}
	.board {
		background: #eee;
		border-collapse: collapse;
	}
	.tasks {
	    height: 200pt;
	}
	.tasks td {
		width:70pt;
		text-align: center;
		border: 1px solid black;
		vertical-align: top;
	}
	.task {
		    background: yellow;
		    border-radius: 6pt;
		    padding: 3pt;
		    margin: 3pt;
		    border-style: solid;
		    border-color: black;
		    border-width: thin;
			text-align: center;
		}
	.board th {
		text-align: center;
		border: 1px solid black;
		background-color: eea;
	}
	
	
	</style>
	<script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
	<script>
	$.fn.animateAppendTo = function(sel, speed) {
		if (speed < 10) {
			this.detach();
			this.appendTo(sel);
			return this;
		}
	    var $this = this,
	        newEle = $this.clone(true).appendTo(sel),
	        newPos = newEle.position();
	    newEle.hide();
		thisPosition = this.position();
		this.width(this.width());
	    $this.css('position', 'absolute').css(thisPosition).animate(newPos, speed, function() {
	        newEle.show();
	        $this.remove();
	    });
	    return newEle;
	};
	</script>
</head>
<body>
	<div class="board-overlay">
		Day: <span id="day"></span>, time: <span id="hour"></span>
	<table class="board">
		<tr>
			<th rowspan="2">Backlog</th>
			<th colspan="2">Analysis</th>
			<th colspan="2">Development</th>
			<th colspan="2">QA</th>
			<th colspan="2">Deployment</th>
		</tr>
		<tr>
			<th>Doing</th>
			<th>Done</th>
			<th>Doing</th>
			<th>Done</th>
			<th>Doing</th>
			<th>Done</th>
			<th>Doing</th>
			<th>Done</th>
		</tr>
		<tr class="tasks">
			<td id="input"></td>
			<td id="analysis"></td>
			<td id="analysed"></td>
			<td id="development"></td>
			<td id="developed"></td>
			<td id="qa"></td>
			<td id="tested"></td>
			<td id="deployment"></td>
			<td id="done"></td>
		</tr>
	</table>
	</div>
	
	<script>
	var hourLengthInSeconds = 0.1;
	var hour=0;
	var taskCounter = 1;
	updateTime(hour);
	var columns = createColumns();
	var tasks = {};
	setTimeout( "hourPassed()", hourLengthInSeconds * 1000 );
	
	function hourPassed() {		
		updateTime(++hour);
		resetColumnsCapacity(columns);
		addNewTasks(columns[0]);
		doWork(columns);
		moveTasks(columns);
		updateUI(columns, tasks);
		setTimeout( "hourPassed()", hourLengthInSeconds * 1000 );
	}
	
	function updateTime(hour) {
		$("#day").text(Math.floor(hour / 8) + 1);
		$("#hour").text((hour % 8 + 9) +":00");
	}
	
	function addNewTasks(column) {
		if (Math.random() < 0.5) {
			var task = {};
			task.id = "Task" + (taskCounter++);
			task.column = column;
			task.created = hour;
			task.analysis = 4;
			task.development = 7;
			task.qa = 5;
			task.deployment = 1;
			column.tasks.push(task);
			tasks[task.id] = task;
		}
	}
	
	function moveTasks(columns) {
		var changed = true;
		while (changed) {
			changed = false;
			columns.forEach(function(column) {
				column.tasks.forEach(function(task) {
					if (finished(task)) {
						var nextColumn = findNextColumn(task, columns);
						if (nextColumn != column) {
							changed = true;
							column.tasks.splice( column.tasks.indexOf(task), 1 );
							task.column = nextColumn;
							if (nextColumn) {
							 	nextColumn.tasks.push(task);
							}
						}
						
					}
				});
			});
		}
	}
	
	function findNextColumn(task, columns) {
		var column = task.column;
		var index = columns.indexOf(column);
		while (column && finished(task, column) && availableSpace(columns[index + 1]) > 0) {
			column = columns[++index];
		}
		return column;
	}
	
	function availableSpace(column) {
		if (!column) return 1;
		var limit = column.limit;
		return limit - column.tasks.length;
	}
	
	function finished(task, column) {
		if (!column) {
			column = task.column;
		}
		return task[column.name] == 0 || !task[column.name];
	}
	
	function doWork(columns) {
		columns.forEach(function(column){
			var i=0;
			while(column.capacityLeft > 0 && i < column.tasks.length) {
				var task = column.tasks[i++];
				if (task[column.name] && task[column.name] > 0) {
					task[column.name] = task[column.name] - 1;
					column.capacityLeft--;
				}
			}
		});
	}
	
	function resetColumnsCapacity(columns) {
		columns.forEach(function(column){
			column.capacityLeft = column.capacity;
		});
	}
	
	function createColumns() {
		var columns = [];
		columns.push(createColumn("input"));
		columns.push(createColumn("analysis", 5, 2));
		columns.push(createColumn("analysed"));
		columns.push(createColumn("development", 5, 3));
		columns.push(createColumn("developed"));
		columns.push(createColumn("qa", 5, 2));
		columns.push(createColumn("tested"));
		columns.push(createColumn("deployment", 5, 1));
		columns.push(createColumn("done"));
		return columns;
	}
	
	function createColumn(name, limit = Number.POSITIVE_INFINITY, capacity = Number.POSITIVE_INFINITY) {
		var column = {};
		column.name = name;
		column.limit = limit;
		column.capacity = capacity;
		column.capacityLeft = capacity;
		column.tasks = [];
		return column;
	}
	
	function updateUI(columns, tasks) {
		$($('.tasks td').get().reverse()).each(function() {
			var columnVisual = $(this);
			var id = columnVisual.attr("id");
			columnVisual.children().each(function() {
				var taskVisual = $(this);
				var taskId = taskVisual.attr("id");
				var task = tasks[taskId];
				if (task.column && task.column.name != id) {
					taskVisual.animateAppendTo(task.column.name,  hourLengthInSeconds * 100);
				} else if (!task.column) {
					taskVisual.remove();
					delete tasks[taskId];
				}
			});
		});
		for (var key in tasks) {
		    if (!tasks.hasOwnProperty(key)) {
		        continue;
		    }
		    var task = tasks[key];
			if ($("#" + task.id).length == 0) {
				var newTask = $("<div class='task' id='" + task.id +"'>" + task.id +"</div>");
				$('#' + task.column.name).append(newTask);
			}
		}
		
	}
	</script>
</body>
</html>